#!/usr/bin/env bash
#
# uninstall script for upnup bash script
# please review before installing as this script requires root privileges
# tldr; uninstalls two executable scripts from /usr/local/bin and removes a .config directory

dependencycheck() {
    numdependencies="$#"
    dependencies=("$@")
    missingdependencies=0
    for ((i = 0; i < numdependencies; i++)) ; do
        if ! command -v "${dependencies[$i]}" &> /dev/null ; then
            printf "dependency not met: %s\n" "${dependencies[$i]}"
            missingdependencies=$((missingdependencies+1))
        fi
    done
    if [ $missingdependencies -gt 0 ]; then
        exit 1
    fi
}

dependencycheck sudo rm

function remove_upnup() {
    if [[ -f /usr/local/bin/upnup ]] ; then
        if command -v "doas" &> /dev/null ; then
            doas rm /usr/local/bin/upnup
            printf "%s\n" "removing /usr/local/bin/upnup ..."
        else
            sudo rm /usr/local/bin/upnup
            printf "%s\n" "removing /usr/local/bin/upnup ..."
        fi
    fi
}

function remove_annota() {
    if [[ -f /usr/local/bin/annota ]] ; then
        if command -v "doas" &> /dev/null ; then
            doas rm /usr/local/bin/annota
            printf "%s\n" "removing /usr/local/bin/annota ..."
        else
            sudo rm /usr/local/bin/annota
            printf "%s\n" "removing /usr/local/bin/annota ..."
        fi
    fi
}

function remove_config() {
    if [[ -d "$HOME/.config/upnup/" ]] ; then
        printf "%s\n" "removing ~/.config/upnup ..."
        if command -v "doas" &> /dev/null ; then
            doas rm -r "$HOME"/.config/upnup
        else
            sudo rm -r "$HOME"/.config/upnup
        fi
    fi
}

function remove_man() {
    if [[ -f "/usr/share/man/man1/upnup.1.gz" ]] ; then
        printf "%s\n" "removing man page /usr/share/man/man1/upnup.1.gz ..."
        if command -v "doas" &> /dev/null ; then
            doas rm /usr/share/man/man1/upnup.1.gz
        else
            sudo rm /usr/share/man/man1/upnup.1.gz
        fi
    fi
}

remove_upnup
remove_annota
remove_config
remove_man
