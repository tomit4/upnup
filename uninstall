#!/usr/bin/env bash
set -e

dependencycheck() {
    numdependencies="$#"
    dependencies=("$@")
    missingdependencies=0
    for ((i = 0; i < numdependencies; i++)) ; do
        if ! command -v "${dependencies[$i]}" &> /dev/null ; then
            printf "dependency not met: %s\n" "${dependencies[$i]}"
            missingdependencies=$((missingdependencies+1))
        fi
    done
    if [ $missingdependencies -gt 0 ]; then
        exit 1
    fi
}

dependencycheck sudo rm

function removeupnup() {
    if [[ -f /usr/local/bin/upnup ]] ; then
        if command -v "doas" &> /dev/null ; then
            doas rm /usr/local/bin/upnup
            printf "%s\n" "removing /usr/local/bin/upnup ..."
        else
            sudo rm /usr/local/bin/upnup
            printf "%s\n" "removing /usr/local/bin/upnup ..."
        fi
    fi
}

function removeconfig() {
    if [[ -d "$HOME/.config/upnup/" ]] ; then
        printf "%s\n" "removing ~/.config/upnup ..."
        if command -v "doas" &> /dev/null ; then
            doas rm -r "$HOME"/.config/upnup
        else
            sudo rm -r "$HOME"/.config/upnup
        fi
    fi
}

# function removeman() {
    # if [[ -f "/usr/share/man/man1/upnup.1.gz" ]] ; then
        # printf "%s\n" "removing man page /usr/share/man/man1/upnup.1.gz ..."
        # if command -v "doas" &> /dev/null ; then
            # doas rm /usr/share/man/man1/upnup.1.gz
        # else
            # sudo rm /usr/share/man/man1/upnup.1.gz
        # fi
    # fi
# }

removeupnup
removeconfig
# removeman
